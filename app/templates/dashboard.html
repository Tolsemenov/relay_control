{% extends "base.html" %}

{% block relay_buttons %}
  <<!-- üîå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–µ -->
<div class="container text-center mt-4">
  <div class="row justify-content-center">
    {% for relay in relays.values() %}
    <div class="col-6 col-sm-3 mb-4">
      <form method="get" action="{{ url_for('dashboard.toggle_relay', relay_key=relay.relay_key) }}">
        <div class="d-flex flex-column align-items-center">
          <strong class="mb-2">{{ relay.name }}</strong>
          <button type="submit"
                  class="btn rounded-circle p-3"
                  style="
                    width: 70px;
                    height: 70px;
                    background-color: {% if relay.status %}#dc3545{% else %}#ffffff{% endif %};
                    border: 2px solid #dc3545;">
            <img src="{{ url_for('static', filename='power_icon_white.png') }}"
                 style="width: 30px; height: 30px;" alt="Power">
          </button>
        </div>
      </form>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block content %}
  <h3 class="mt-4">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–≤–∫–ª—é—á–µ–Ω–∏–π</h3>
  <a href="{{ url_for('dashboard.add_schedule') }}" class="btn btn-success btn-sm mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</a>

  {% if schedules %}
    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è -->
    <div class="d-block d-md-none">
      {% for s in schedules %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">{{ relay_names.get(s.target.name, s.target.value) }}</h5>
          <p class="card-text">
            <strong>–î–Ω–∏:</strong> {{ s.days }}<br>
            <strong>–í—Ä–µ–º—è:</strong> {{ s.time_on.strftime('%H:%M') }}<br>
            <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ s.duration_min }} –º–∏–Ω<br>
            <strong>–í–∫–ª:</strong> {% if s.enabled %}‚úÖ{% else %}‚ùå{% endif %}
          </p>
          <div class="d-flex flex-wrap gap-2 justify-content-end">
            <a href="{{ url_for('dashboard.edit_schedule', schedule_id=s.id) }}" class="btn btn-primary btn-sm">‚úèÔ∏è</a>
            <a href="{{ url_for('dashboard.delete_schedule', schedule_id=s.id) }}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É {{ s.id }}?');">üóëÔ∏è</a>
            <a href="{{ url_for('dashboard.toggle_schedule', schedule_id=s.id) }}"
               class="btn btn-secondary btn-sm">üîÅ</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
    <div class="table-responsive d-none d-md-block">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>–†–µ–ª–µ</th>
            <th>–î–Ω–∏</th>
            <th>–í—Ä–µ–º—è</th>
            <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</th>
            <th>–í–∫–ª.</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for s in schedules %}
          <tr>
            <td>{{ s.id }}</td>
            <td>{{ relay_names.get(s.target.name, s.target.value) }}</td>
            <td>{{ s.days }}</td>
            <td>{{ s.time_on.strftime('%H:%M') }}</td>
            <td>{{ s.duration_min }}</td>
            <td>{% if s.enabled %}‚úÖ{% else %}‚ùå{% endif %}</td>
            <td>
              <div class="d-flex flex-wrap gap-2">
                <a href="{{ url_for('dashboard.edit_schedule', schedule_id=s.id) }}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>
                <a href="{{ url_for('dashboard.delete_schedule', schedule_id=s.id) }}"
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É {{ s.id }}?');">üóëÔ∏è</a>
                <a href="{{ url_for('dashboard.toggle_schedule', schedule_id=s.id) }}"
                   class="btn btn-sm btn-secondary">üîÅ</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞–Ω–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.</p>
  {% endif %}
{% endblock %}
